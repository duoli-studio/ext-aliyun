## 技术文档

### 系统所需扩展

```
- [F]php 7.0+
- [P]php-bcmath(*inx)
- [F]php-pdo
- [F]php-gd
- [F]php-curl
- [F]php-openssl
- [F]php-mbstring
- [F]php-mcrypt
- [F]php-sqlite3
- [F]php-soap
```

### 环境安装

```
# 根目录
$ composer install -vvv

# 扩展目录
# extension/ext-alipay
# extension/ext-aliyun
# extension/ext-netease
# extension/ext-wxpay
$ composer update -vvv

# 环境
php artisan system:user init_role
php artisan system:user create_user

```

### PHP
- [EloquentFilter](https://github.com/Tucker-Eric/EloquentFilter)

## 线上配置

### 服务配置
```
# 计划任务
# * * * * * php /source/code/directory/artisan schedule:run 1>> /dev/null 2>&1
php artisan schedule:run


# 队列监听 / supervisor
php artisan queue:listen

# 配置 socket 服务
centrifugo --config=resources/centrifugo/config.json --admin --port 1942 --web --web_path=resources/centrifugo/app &
```

#### Supervisor

```
[program:play]
process_name=%(program_name)s_%(process_num)02d
command=php /source/code/directory/artisan queue:work --sleep=3 --tries=3 --daemon --queue=play
autostart=true
autorestart=true
user=mark
numprocs=8
redirect_stderr=true
stdout_logfile=/source/code/directory/storage/server/job.log
```

### 环境设置
设置运行环境
```
APP_ENV=local
APP_DEBUG=true
```

生成 APP_KEY
```
$ php artisan key:generate
APP_KEY=base64:J3scto3x2wZNnJlqeKcZSBLUuUcSylIj1t+cJCUEbWY=
```
设置运行网址
运行网址不要有下划线
```
URL_SITE=http://local-domain.com
```
设置数据库
```
DB_HOST=192.168.1.21
DB_DATABASE=play_v2
DB_USERNAME=root
DB_PASSWORD=Markzhao123456#
```
设置 JWT key
```
$ php artisan jwt:secret
JWT_SECRET=XgVv3f3yLEBHmkkoipLil22oxaD1ZWaB
```
设置缓存
```
# 缓存驱动
CACHE_DRIVER=redis
# 缓存前缀
CACHE_PREFIX=play_v1
```
设置 Session驱动方式
```
SESSION_DRIVER=redis
```
设置队列驱动
```
# 本地使用 同步驱动, 线上使用redis , 默认为 sync
QUEUE_DRIVER=sync
```

### 常用命令

```
php artisan ide-helper:model '模型命名空间+模型名称'  # 生成 filter 模型注释
```
